<!DOCTYPE html>

<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UGC Studio - Connexion</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

```
    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
    }
    
    .container {
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        padding: 40px;
        width: 100%;
        max-width: 450px;
    }
    
    .logo {
        width: 80px;
        height: 80px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 50%;
        margin: 0 auto 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 40px;
    }
    
    h1 {
        text-align: center;
        font-size: 32px;
        font-weight: bold;
        color: #1a202c;
        margin-bottom: 10px;
    }
    
    .subtitle {
        text-align: center;
        color: #718096;
        margin-bottom: 30px;
    }
    
    label {
        display: block;
        font-size: 14px;
        font-weight: 600;
        color: #4a5568;
        margin-bottom: 8px;
    }
    
    input {
        width: 100%;
        padding: 14px 16px;
        border: 2px solid #e2e8f0;
        border-radius: 10px;
        font-size: 16px;
        outline: none;
        text-transform: uppercase;
        font-weight: 600;
        letter-spacing: 1px;
        transition: border-color 0.2s;
    }
    
    input:focus {
        border-color: #667eea;
    }
    
    button {
        width: 100%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        font-weight: 600;
        padding: 14px;
        border-radius: 10px;
        border: none;
        font-size: 16px;
        cursor: pointer;
        margin-top: 20px;
        transition: transform 0.2s;
    }
    
    button:hover {
        transform: translateY(-2px);
    }
    
    button:disabled {
        background: #cbd5e0;
        cursor: not-allowed;
        transform: none;
    }
    
    .info {
        margin-top: 20px;
        text-align: center;
        font-size: 13px;
        color: #718096;
    }
    
    .info strong {
        color: #667eea;
        font-family: monospace;
    }
    
    .quota-info {
        background: #edf2f7;
        padding: 15px;
        border-radius: 10px;
        margin-top: 20px;
        text-align: center;
    }
    
    .quota-info h3 {
        font-size: 18px;
        color: #1a202c;
        margin-bottom: 10px;
    }
    
    .quota-number {
        font-size: 48px;
        font-weight: bold;
        color: #48bb78;
    }
    
    .quota-text {
        color: #718096;
        margin-top: 5px;
    }
    
    .success {
        background: #c6f6d5;
        border: 2px solid #68d391;
        color: #22543d;
        padding: 15px;
        border-radius: 10px;
        margin-top: 15px;
        text-align: center;
        font-weight: 600;
    }
    
    .admin-panel {
        background: #f7fafc;
        padding: 20px;
        border-radius: 10px;
        margin-top: 20px;
    }
    
    .admin-panel h2 {
        font-size: 20px;
        color: #1a202c;
        margin-bottom: 15px;
    }
    
    .student-input {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
    }
    
    .student-input input {
        flex: 1;
        text-transform: none;
        font-weight: normal;
        letter-spacing: normal;
    }
    
    .student-input button {
        width: auto;
        padding: 14px 20px;
        margin: 0;
    }
    
    .student-list {
        max-height: 300px;
        overflow-y: auto;
    }
    
    .student-item {
        background: white;
        padding: 12px;
        border-radius: 8px;
        margin-bottom: 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .student-item strong {
        color: #667eea;
        font-family: monospace;
    }
    
    .btn-delete {
        background: #fc8181;
        padding: 6px 12px;
        font-size: 12px;
        margin: 0;
        width: auto;
    }
    
    .btn-logout {
        background: #718096;
        margin-top: 10px;
    }
    
    .stats-box {
        background: white;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 15px;
        text-align: center;
    }
</style>
```

</head>
<body>
    <div class="container">
        <div id="app"></div>
    </div>

```
<script>
    // Configuration
    const CONFIG = {
        ugcAppUrl: 'https://copy-of-ugc-studio-522430809084.us-west1.run.app/',
        dailyLimit: 6,
        adminCode: 'ADMIN2024'
    };

    // √âtat de l'application
    let state = {
        view: 'login',
        isAdmin: false,
        currentUser: null,
        students: [],
        usage: {}
    };

    // Charger les donn√©es au d√©marrage
    function loadData() {
        try {
            const savedStudents = localStorage.getItem('ugc_students');
            const savedUsage = localStorage.getItem('ugc_usage');
            
            if (savedStudents) state.students = JSON.parse(savedStudents);
            if (savedUsage) state.usage = JSON.parse(savedUsage);
            
            cleanOldUsage();
        } catch (error) {
            console.error('Erreur chargement:', error);
        }
    }

    // Sauvegarder les donn√©es
    function saveData() {
        try {
            localStorage.setItem('ugc_students', JSON.stringify(state.students));
            localStorage.setItem('ugc_usage', JSON.stringify(state.usage));
        } catch (error) {
            console.error('Erreur sauvegarde:', error);
        }
    }

    // Nettoyer les anciennes donn√©es
    function cleanOldUsage() {
        const today = new Date().toDateString();
        let cleaned = false;
        
        Object.keys(state.usage).forEach(code => {
            if (state.usage[code].date !== today) {
                delete state.usage[code];
                cleaned = true;
            }
        });
        
        if (cleaned) saveData();
    }

    // G√©n√©rer un code al√©atoire
    function generateCode() {
        const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
        let code = '';
        for (let i = 0; i < 6; i++) {
            code += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        return code;
    }

    // Obtenir le quota restant
    function getRemainingQuota(code) {
        const today = new Date().toDateString();
        const usage = state.usage[code];
        
        if (!usage || usage.date !== today) {
            return CONFIG.dailyLimit;
        }
        
        return Math.max(0, CONFIG.dailyLimit - usage.count);
    }

    // Utiliser une g√©n√©ration
    function useQuota(code) {
        const today = new Date().toDateString();
        
        if (!state.usage[code] || state.usage[code].date !== today) {
            state.usage[code] = { date: today, count: 0 };
        }
        
        state.usage[code].count++;
        saveData();
    }

    // G√©rer la connexion
    function handleLogin(code) {
        if (!code) {
            alert('‚ùå Veuillez entrer un code');
            return;
        }
        
        if (code === CONFIG.adminCode) {
            state.isAdmin = true;
            state.view = 'admin';
            render();
            return;
        }
        
        const student = state.students.find(s => s.code === code);
        if (student) {
            state.currentUser = student;
            state.view = 'student';
            render();
        } else {
            alert('‚ùå Code invalide ! V√©rifiez votre code.');
        }
    }

    // Ajouter un √©l√®ve
    function addStudent(name) {
        if (!name.trim()) {
            alert('‚ùå Entrez un nom d\'√©l√®ve');
            return;
        }
        
        const code = generateCode();
        const newStudent = {
            id: Date.now(),
            name: name.trim(),
            code: code,
            createdAt: new Date().toISOString()
        };
        
        state.students.push(newStudent);
        saveData();
        render();
        
        alert('‚úÖ √âl√®ve ajout√© !\n\nNom: ' + name + '\nCode: ' + code + '\n\nDonnez ce code √† l\'√©l√®ve.');
    }

    // Supprimer un √©l√®ve
    function deleteStudent(id) {
        if (!confirm('‚ùå Supprimer cet √©l√®ve ?')) return;
        
        state.students = state.students.filter(s => s.id !== id);
        saveData();
        render();
    }

    // Lancer l'application UGC
    function launchApp() {
        const code = state.currentUser.code;
        const remaining = getRemainingQuota(code);
        
        if (remaining <= 0) {
            alert('‚ö†Ô∏è Quota √©puis√© ! Revenez demain.');
            return;
        }
        
        useQuota(code);
        const newRemaining = getRemainingQuota(code);
        
        document.getElementById('message').innerHTML = 
            '<div class="success">‚úÖ Quota utilis√© ! Il vous reste ' + newRemaining + 
            ' g√©n√©ration' + (newRemaining > 1 ? 's' : '') + 
            '<br>üîÑ Redirection dans 3 secondes...</div>';
        
        setTimeout(function() {
            window.location.href = CONFIG.ugcAppUrl;
        }, 3000);
    }

    // D√©connexion
    function logout() {
        state.view = 'login';
        state.isAdmin = false;
        state.currentUser = null;
        render();
    }

    // Rendu de l'interface
    function render() {
        const app = document.getElementById('app');
        
        if (state.view === 'login') {
            app.innerHTML = `
                <div class="logo">üé®</div>
                <h1>UGC Studio</h1>
                <p class="subtitle">G√©n√©rateur d'images IA</p>
                
                <label for="codeInput">Code d'acc√®s</label>
                <input type="text" id="codeInput" placeholder="Entrez votre code" maxlength="10" />
                <button onclick="handleLoginClick()">üîì Se connecter</button>
                
                <div class="info">
                    <p>√âl√®ve ? Utilisez le code fourni par votre enseignant</p>
                    <p style="margin-top: 5px;">Enseignant ? Code: <strong>ADMIN2024</strong></p>
                </div>
            `;
            
            setTimeout(function() {
                const input = document.getElementById('codeInput');
                input.focus();
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') handleLoginClick();
                });
            }, 100);
        }
        else if (state.view === 'admin') {
            renderAdmin();
        }
        else if (state.view === 'student') {
            renderStudent();
        }
    }

    function renderAdmin() {
        const app = document.getElementById('app');
        const totalUsage = Object.values(state.usage)
            .filter(u => u.date === new Date().toDateString())
            .reduce((sum, u) => sum + u.count, 0);
        
        app.innerHTML = `
            <div class="admin-panel">
                <h2>üõ°Ô∏è Administration</h2>
                
                <div class="stats-box">
                    <div style="font-size: 14px; color: #718096;">G√©n√©rations aujourd'hui</div>
                    <div style="font-size: 32px; font-weight: bold; color: #667eea;">${totalUsage}</div>
                    <div style="font-size: 14px; color: #718096;">${state.students.length} √©l√®ves inscrits</div>
                </div>
                
                <div class="student-input">
                    <input type="text" id="newStudentName" placeholder="Nom de l'√©l√®ve" />
                    <button onclick="addStudentClick()">‚ûï Ajouter</button>
                </div>
                
                <div class="student-list" id="studentList"></div>
                
                <button onclick="logout()" class="btn-logout">üö™ D√©connexion</button>
            </div>
        `;
        
        renderStudentList();
        
        setTimeout(function() {
            const input = document.getElementById('newStudentName');
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') addStudentClick();
            });
        }, 100);
    }

    function renderStudentList() {
        const list = document.getElementById('studentList');
        
        if (state.students.length === 0) {
            list.innerHTML = '<p style="text-align: center; color: #718096; padding: 20px;">Aucun √©l√®ve ajout√©</p>';
            return;
        }
        
        list.innerHTML = state.students.map(function(s) {
            const remaining = getRemainingQuota(s.code);
            const used = CONFIG.dailyLimit - remaining;
            return `
                <div class="student-item">
                    <div>
                        <div style="font-weight: 600; color: #1a202c;">${s.name}</div>
                        <div style="font-size: 12px; color: #718096;">
                            Code: <strong>${s.code}</strong> | ${used}/${CONFIG.dailyLimit} utilis√©es
                        </div>
                    </div>
                    <button onclick="deleteStudent(${s.id})" class="btn-delete">üóëÔ∏è</button>
                </div>
            `;
        }).join('');
    }

    function renderStudent() {
        const app = document.getElementById('app');
        const remaining = getRemainingQuota(state.currentUser.code);
        
        if (remaining > 0) {
            app.innerHTML = `
                <div class="quota-info">
                    <h3>üëã Bonjour ${state.currentUser.name} !</h3>
                    <div class="quota-number">${remaining}</div>
                    <div class="quota-text">g√©n√©ration${remaining > 1 ? 's' : ''} restante${remaining > 1 ? 's' : ''} aujourd'hui</div>
                </div>
                <div id="message"></div>
                <button onclick="launchApp()">üöÄ Lancer UGC Studio</button>
                <button onclick="logout()" style="background: #718096; margin-top: 10px;">üö™ D√©connexion</button>
            `;
        } else {
            app.innerHTML = `
                <div class="quota-info">
                    <h3>üëã Bonjour ${state.currentUser.name} !</h3>
                    <div style="font-size: 60px; margin: 20px 0;">‚è∞</div>
                    <h3 style="color: #e53e3e;">Quota journalier atteint</h3>
                    <p style="margin-top: 10px; color: #718096;">
                        Vous avez utilis√© vos ${CONFIG.dailyLimit} g√©n√©rations pour aujourd'hui.<br>
                        Revenez demain !
                    </p>
                </div>
                <button onclick="logout()" style="background: #718096;">üö™ D√©connexion</button>
            `;
        }
    }

    // Fonctions globales pour les boutons
    function handleLoginClick() {
        const input = document.getElementById('codeInput');
        handleLogin(input.value.trim().toUpperCase());
    }

    function addStudentClick() {
        const input = document.getElementById('newStudentName');
        addStudent(input.value);
        input.value = '';
    }

    // Initialisation
    loadData();
    render();
</script>
```

</body>
</html>
